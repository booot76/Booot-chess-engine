unit Sort;

interface
uses params,MoveGen,move,Board,history,attacks,material;

TYPE
    TSEEValues = array[BlackKing..WhiteKing] of integer;

CONST
    TransScore  = 800000;
    GoodCapture = 700000;
    KillerScore = 500000;
    SimpleScore=-20000;
    BadCapture=-32767;
    HistoryMax=16384;
    SortNextGood=0;
    SortNext=1;
    SortNextBad=2;
    SEEValues  : TSEEValues=(100,10,5,3,3,1,0,1,3,3,5,10,100);
    PiesePrice : TSEEValues=(Mate,QueenValueEnd,RookValueEnd,BishopValueEnd,KnightValueEnd,PawnValueEnd,0,PawnValueEnd,KnightValueEnd,BishopValueEnd,RookValueEnd,QueenValueEnd,mate);
    SortCenter : TbytesArray =
(0,5,10,15,15,10,5,0,
5,10,15,20,20,15,10,5,
10,15,20,25,25,20,15,10,
15,20,25,30,30,25,20,15,
15,20,25,30,30,25,20,15,
10,15,20,25,25,20,15,10,
5,10,15,20,20,15,10,5,
0,5,10,15,15,10,5,0);

    LDIR : TBBLINE =
($0000000000000000,$0000000000000001,$0000000000000003,$0000000000000007,$000000000000000F,$000000000000001F,$000000000000003F,$000000000000007F,
$0000000000000000,$0000000000000100,$0000000000000300,$0000000000000700,$0000000000000F00,$0000000000001F00,$0000000000003F00,$0000000000007F00,
$0000000000000000,$0000000000010000,$0000000000030000,$0000000000070000,$00000000000F0000,$00000000001F0000,$00000000003F0000,$00000000007F0000,
$0000000000000000,$0000000001000000,$0000000003000000,$0000000007000000,$000000000F000000,$000000001F000000,$000000003F000000,$000000007F000000,
$0000000000000000,$0000000100000000,$0000000300000000,$0000000700000000,$0000000F00000000,$0000001F00000000,$0000003F00000000,$0000007F00000000,
$0000000000000000,$0000010000000000,$0000030000000000,$0000070000000000,$00000F0000000000,$00001F0000000000,$00003F0000000000,$00007F0000000000,
$0000000000000000,$0001000000000000,$0003000000000000,$0007000000000000,$000F000000000000,$001F000000000000,$003F000000000000,$007F000000000000,
$0000000000000000,$0100000000000000,$0300000000000000,$0700000000000000,$0F00000000000000,$1F00000000000000,$3F00000000000000,$7F00000000000000);

    RDIR : TBBLINE =
($00000000000000FE,$00000000000000FC,$00000000000000F8,$00000000000000F0,$00000000000000E0,$00000000000000C0,$0000000000000080,$0000000000000000,
$000000000000FE00,$000000000000FC00,$000000000000F800,$000000000000F000,$000000000000E000,$000000000000C000,$0000000000008000,$0000000000000000,
$0000000000FE0000,$0000000000FC0000,$0000000000F80000,$0000000000F00000,$0000000000E00000,$0000000000C00000,$0000000000800000,$0000000000000000,
$00000000FE000000,$00000000FC000000,$00000000F8000000,$00000000F0000000,$00000000E0000000,$00000000C0000000,$0000000080000000,$0000000000000000,
$000000FE00000000,$000000FC00000000,$000000F800000000,$000000F000000000,$000000E000000000,$000000C000000000,$0000008000000000,$0000000000000000,
$0000FE0000000000,$0000FC0000000000,$0000F80000000000,$0000F00000000000,$0000E00000000000,$0000C00000000000,$0000800000000000,$0000000000000000,
$00FE000000000000,$00FC000000000000,$00F8000000000000,$00F0000000000000,$00E0000000000000,$00C0000000000000,$0080000000000000,$0000000000000000,
$FE00000000000000,$FC00000000000000,$F800000000000000,$F000000000000000,$E000000000000000,$C000000000000000,$8000000000000000,$0000000000000000);

    UDIR : TBBLINE =
($0101010101010100,$0202020202020200,$0404040404040400,$0808080808080800,$1010101010101000,$2020202020202000,$4040404040404000,$8080808080808000,
$0101010101010000,$0202020202020000,$0404040404040000,$0808080808080000,$1010101010100000,$2020202020200000,$4040404040400000,$8080808080800000,
$0101010101000000,$0202020202000000,$0404040404000000,$0808080808000000,$1010101010000000,$2020202020000000,$4040404040000000,$8080808080000000,
$0101010100000000,$0202020200000000,$0404040400000000,$0808080800000000,$1010101000000000,$2020202000000000,$4040404000000000,$8080808000000000,
$0101010000000000,$0202020000000000,$0404040000000000,$0808080000000000,$1010100000000000,$2020200000000000,$4040400000000000,$8080800000000000,
$0101000000000000,$0202000000000000,$0404000000000000,$0808000000000000,$1010000000000000,$2020000000000000,$4040000000000000,$8080000000000000,
$0100000000000000,$0200000000000000,$0400000000000000,$0800000000000000,$1000000000000000,$2000000000000000,$4000000000000000,$8000000000000000,
$0000000000000000,$0000000000000000,$0000000000000000,$0000000000000000,$0000000000000000,$0000000000000000,$0000000000000000,$0000000000000000);
    DDIR : TBBLINE =
($0000000000000000,$0000000000000000,$0000000000000000,$0000000000000000,$0000000000000000,$0000000000000000,$0000000000000000,$0000000000000000,
$0000000000000001,$0000000000000002,$0000000000000004,$0000000000000008,$0000000000000010,$0000000000000020,$0000000000000040,$0000000000000080,
$0000000000000101,$0000000000000202,$0000000000000404,$0000000000000808,$0000000000001010,$0000000000002020,$0000000000004040,$0000000000008080,
$0000000000010101,$0000000000020202,$0000000000040404,$0000000000080808,$0000000000101010,$0000000000202020,$0000000000404040,$0000000000808080,
$0000000001010101,$0000000002020202,$0000000004040404,$0000000008080808,$0000000010101010,$0000000020202020,$0000000040404040,$0000000080808080,
$0000000101010101,$0000000202020202,$0000000404040404,$0000000808080808,$0000001010101010,$0000002020202020,$0000004040404040,$0000008080808080,
$0000010101010101,$0000020202020202,$0000040404040404,$0000080808080808,$0000101010101010,$0000202020202020,$0000404040404040,$0000808080808080,
$0001010101010101,$0002020202020202,$0004040404040404,$0008080808080808,$0010101010101010,$0020202020202020,$0040404040404040,$0080808080808080);
    ULDIR : TBBLINE =
($0000000000000000,$0000000000000100,$0000000000010200,$0000000001020400,$0000000102040800,$0000010204081000,$0001020408102000,$0102040810204000,
$0000000000000000,$0000000000010000,$0000000001020000,$0000000102040000,$0000010204080000,$0001020408100000,$0102040810200000,$0204081020400000,
$0000000000000000,$0000000001000000,$0000000102000000,$0000010204000000,$0001020408000000,$0102040810000000,$0204081020000000,$0408102040000000,
$0000000000000000,$0000000100000000,$0000010200000000,$0001020400000000,$0102040800000000,$0204081000000000,$0408102000000000,$0810204000000000,
$0000000000000000,$0000010000000000,$0001020000000000,$0102040000000000,$0204080000000000,$0408100000000000,$0810200000000000,$1020400000000000,
$0000000000000000,$0001000000000000,$0102000000000000,$0204000000000000,$0408000000000000,$0810000000000000,$1020000000000000,$2040000000000000,
$0000000000000000,$0100000000000000,$0200000000000000,$0400000000000000,$0800000000000000,$1000000000000000,$2000000000000000,$4000000000000000,
$0000000000000000,$0000000000000000,$0000000000000000,$0000000000000000,$0000000000000000,$0000000000000000,$0000000000000000,$0000000000000000);
    URDIR : TBBLINE =
($8040201008040200,$0080402010080400,$0000804020100800,$0000008040201000,$0000000080402000,$0000000000804000,$0000000000008000,$0000000000000000,
$4020100804020000,$8040201008040000,$0080402010080000,$0000804020100000,$0000008040200000,$0000000080400000,$0000000000800000,$0000000000000000,
$2010080402000000,$4020100804000000,$8040201008000000,$0080402010000000,$0000804020000000,$0000008040000000,$0000000080000000,$0000000000000000,
$1008040200000000,$2010080400000000,$4020100800000000,$8040201000000000,$0080402000000000,$0000804000000000,$0000008000000000,$0000000000000000,
$0804020000000000,$1008040000000000,$2010080000000000,$4020100000000000,$8040200000000000,$0080400000000000,$0000800000000000,$0000000000000000,
$0402000000000000,$0804000000000000,$1008000000000000,$2010000000000000,$4020000000000000,$8040000000000000,$0080000000000000,$0000000000000000,
$0200000000000000,$0400000000000000,$0800000000000000,$1000000000000000,$2000000000000000,$4000000000000000,$8000000000000000,$0000000000000000,
$0000000000000000,$0000000000000000,$0000000000000000,$0000000000000000,$0000000000000000,$0000000000000000,$0000000000000000,$0000000000000000);
    DLDIR : TBBLINE =
($0000000000000000,$0000000000000000,$0000000000000000,$0000000000000000,$0000000000000000,$0000000000000000,$0000000000000000,$0000000000000000,
$0000000000000000,$0000000000000001,$0000000000000002,$0000000000000004,$0000000000000008,$0000000000000010,$0000000000000020,$0000000000000040,
$0000000000000000,$0000000000000100,$0000000000000201,$0000000000000402,$0000000000000804,$0000000000001008,$0000000000002010,$0000000000004020,
$0000000000000000,$0000000000010000,$0000000000020100,$0000000000040201,$0000000000080402,$0000000000100804,$0000000000201008,$0000000000402010,
$0000000000000000,$0000000001000000,$0000000002010000,$0000000004020100,$0000000008040201,$0000000010080402,$0000000020100804,$0000000040201008,
$0000000000000000,$0000000100000000,$0000000201000000,$0000000402010000,$0000000804020100,$0000001008040201,$0000002010080402,$0000004020100804,
$0000000000000000,$0000010000000000,$0000020100000000,$0000040201000000,$0000080402010000,$0000100804020100,$0000201008040201,$0000402010080402,
$0000000000000000,$0001000000000000,$0002010000000000,$0004020100000000,$0008040201000000,$0010080402010000,$0020100804020100,$0040201008040201);
    DRDIR : TBBLINE =
($0000000000000000,$0000000000000000,$0000000000000000,$0000000000000000,$0000000000000000,$0000000000000000,$0000000000000000,$0000000000000000,
$0000000000000002,$0000000000000004,$0000000000000008,$0000000000000010,$0000000000000020,$0000000000000040,$0000000000000080,$0000000000000000,
$0000000000000204,$0000000000000408,$0000000000000810,$0000000000001020,$0000000000002040,$0000000000004080,$0000000000008000,$0000000000000000,
$0000000000020408,$0000000000040810,$0000000000081020,$0000000000102040,$0000000000204080,$0000000000408000,$0000000000800000,$0000000000000000,
$0000000002040810,$0000000004081020,$0000000008102040,$0000000010204080,$0000000020408000,$0000000040800000,$0000000080000000,$0000000000000000,
$0000000204081020,$0000000408102040,$0000000810204080,$0000001020408000,$0000002040800000,$0000004080000000,$0000008000000000,$0000000000000000,
$0000020408102040,$0000040810204080,$0000081020408000,$0000102040800000,$0000204080000000,$0000408000000000,$0000800000000000,$0000000000000000,
$0002040810204080,$0004081020408000,$0008102040800000,$0010204080000000,$0020408000000000,$0040800000000000,$0080000000000000,$0000000000000000);
    Direction : TpositionValue =
((000,010,010,010,010,010,010,010,001,011,000,000,000,000,000,000,
001,000,011,000,000,000,000,000,001,000,000,011,000,000,000,000,
001,000,000,000,011,000,000,000,001,000,000,000,000,011,000,000,
001,000,000,000,000,000,011,000,001,000,000,000,000,000,000,011
),(-010,000,010,010,010,010,010,010,-009,001,011,000,000,000,000,000,
000,001,000,011,000,000,000,000,000,001,000,000,011,000,000,000,
000,001,000,000,000,011,000,000,000,001,000,000,000,000,011,000,
000,001,000,000,000,000,000,011,000,001,000,000,000,000,000,000
),(-010,-010,000,010,010,010,010,010,000,-009,001,011,000,000,000,000,
-009,000,001,000,011,000,000,000,000,000,001,000,000,011,000,000,
000,000,001,000,000,000,011,000,000,000,001,000,000,000,000,011,
000,000,001,000,000,000,000,000,000,000,001,000,000,000,000,000
),(-010,-010,-010,000,010,010,010,010,000,000,-009,001,011,000,000,000,
000,-009,000,001,000,011,000,000,-009,000,000,001,000,000,011,000,
000,000,000,001,000,000,000,011,000,000,000,001,000,000,000,000,
000,000,000,001,000,000,000,000,000,000,000,001,000,000,000,000
),(-010,-010,-010,-010,000,010,010,010,000,000,000,-009,001,011,000,000,
000,000,-009,000,001,000,011,000,000,-009,000,000,001,000,000,011,
-009,000,000,000,001,000,000,000,000,000,000,000,001,000,000,000,
000,000,000,000,001,000,000,000,000,000,000,000,001,000,000,000
),(-010,-010,-010,-010,-010,000,010,010,000,000,000,000,-009,001,011,000,
000,000,000,-009,000,001,000,011,000,000,-009,000,000,001,000,000,
000,-009,000,000,000,001,000,000,-009,000,000,000,000,001,000,000,
000,000,000,000,000,001,000,000,000,000,000,000,000,001,000,000
),(-010,-010,-010,-010,-010,-010,000,010,000,000,000,000,000,-009,001,011,
000,000,000,000,-009,000,001,000,000,000,000,-009,000,000,001,000,
000,000,-009,000,000,000,001,000,000,-009,000,000,000,000,001,000,
-009,000,000,000,000,000,001,000,000,000,000,000,000,000,001,000
),(-010,-010,-010,-010,-010,-010,-010,000,000,000,000,000,000,000,-009,001,
000,000,000,000,000,-009,000,001,000,000,000,000,-009,000,000,001,
000,000,000,-009,000,000,000,001,000,000,-009,000,000,000,000,001,
000,-009,000,000,000,000,000,001,-009,000,000,000,000,000,000,001
),(-001,009,000,000,000,000,000,000,000,010,010,010,010,010,010,010,
001,011,000,000,000,000,000,000,001,000,011,000,000,000,000,000,
001,000,000,011,000,000,000,000,001,000,000,000,011,000,000,000,
001,000,000,000,000,011,000,000,001,000,000,000,000,000,011,000
),(-011,-001,009,000,000,000,000,000,-010,000,010,010,010,010,010,010,
-009,001,011,000,000,000,000,000,000,001,000,011,000,000,000,000,
000,001,000,000,011,000,000,000,000,001,000,000,000,011,000,000,
000,001,000,000,000,000,011,000,000,001,000,000,000,000,000,011
),(000,-011,-001,009,000,000,000,000,-010,-010,000,010,010,010,010,010,
000,-009,001,011,000,000,000,000,-009,000,001,000,011,000,000,000,
000,000,001,000,000,011,000,000,000,000,001,000,000,000,011,000,
000,000,001,000,000,000,000,011,000,000,001,000,000,000,000,000
),(000,000,-011,-001,009,000,000,000,-010,-010,-010,000,010,010,010,010,
000,000,-009,001,011,000,000,000,000,-009,000,001,000,011,000,000,
-009,000,000,001,000,000,011,000,000,000,000,001,000,000,000,011,
000,000,000,001,000,000,000,000,000,000,000,001,000,000,000,000
),(000,000,000,-011,-001,009,000,000,-010,-010,-010,-010,000,010,010,010,
000,000,000,-009,001,011,000,000,000,000,-009,000,001,000,011,000,
000,-009,000,000,001,000,000,011,-009,000,000,000,001,000,000,000,
000,000,000,000,001,000,000,000,000,000,000,000,001,000,000,000
),(000,000,000,000,-011,-001,009,000,-010,-010,-010,-010,-010,000,010,010,
000,000,000,000,-009,001,011,000,000,000,000,-009,000,001,000,011,
000,000,-009,000,000,001,000,000,000,-009,000,000,000,001,000,000,
-009,000,000,000,000,001,000,000,000,000,000,000,000,001,000,000
),(000,000,000,000,000,-011,-001,009,-010,-010,-010,-010,-010,-010,000,010,
000,000,000,000,000,-009,001,011,000,000,000,000,-009,000,001,000,
000,000,000,-009,000,000,001,000,000,000,-009,000,000,000,001,000,
000,-009,000,000,000,000,001,000,-009,000,000,000,000,000,001,000
),(000,000,000,000,000,000,-011,-001,-010,-010,-010,-010,-010,-010,-010,000,
000,000,000,000,000,000,-009,001,000,000,000,000,000,-009,000,001,
000,000,000,000,-009,000,000,001,000,000,000,-009,000,000,000,001,
000,000,-009,000,000,000,000,001,000,-009,000,000,000,000,000,001
),(-001,000,009,000,000,000,000,000,-001,009,000,000,000,000,000,000,
000,010,010,010,010,010,010,010,001,011,000,000,000,000,000,000,
001,000,011,000,000,000,000,000,001,000,000,011,000,000,000,000,
001,000,000,000,011,000,000,000,001,000,000,000,000,011,000,000
),(000,-001,000,009,000,000,000,000,-011,-001,009,000,000,000,000,000,
-010,000,010,010,010,010,010,010,-009,001,011,000,000,000,000,000,
000,001,000,011,000,000,000,000,000,001,000,000,011,000,000,000,
000,001,000,000,000,011,000,000,000,001,000,000,000,000,011,000
),(-011,000,-001,000,009,000,000,000,000,-011,-001,009,000,000,000,000,
-010,-010,000,010,010,010,010,010,000,-009,001,011,000,000,000,000,
-009,000,001,000,011,000,000,000,000,000,001,000,000,011,000,000,
000,000,001,000,000,000,011,000,000,000,001,000,000,000,000,011
),(000,-011,000,-001,000,009,000,000,000,000,-011,-001,009,000,000,000,
-010,-010,-010,000,010,010,010,010,000,000,-009,001,011,000,000,000,
000,-009,000,001,000,011,000,000,-009,000,000,001,000,000,011,000,
000,000,000,001,000,000,000,011,000,000,000,001,000,000,000,000
),(000,000,-011,000,-001,000,009,000,000,000,000,-011,-001,009,000,000,
-010,-010,-010,-010,000,010,010,010,000,000,000,-009,001,011,000,000,
000,000,-009,000,001,000,011,000,000,-009,000,000,001,000,000,011,
-009,000,000,000,001,000,000,000,000,000,000,000,001,000,000,000
),(000,000,000,-011,000,-001,000,009,000,000,000,000,-011,-001,009,000,
-010,-010,-010,-010,-010,000,010,010,000,000,000,000,-009,001,011,000,
000,000,000,-009,000,001,000,011,000,000,-009,000,000,001,000,000,
000,-009,000,000,000,001,000,000,-009,000,000,000,000,001,000,000
),(000,000,000,000,-011,000,-001,000,000,000,000,000,000,-011,-001,009,
-010,-010,-010,-010,-010,-010,000,010,000,000,000,000,000,-009,001,011,
000,000,000,000,-009,000,001,000,000,000,000,-009,000,000,001,000,
000,000,-009,000,000,000,001,000,000,-009,000,000,000,000,001,000
),(000,000,000,000,000,-011,000,-001,000,000,000,000,000,000,-011,-001,
-010,-010,-010,-010,-010,-010,-010,000,000,000,000,000,000,000,-009,001,
000,000,000,000,000,-009,000,001,000,000,000,000,-009,000,000,001,
000,000,000,-009,000,000,000,001,000,000,-009,000,000,000,000,001
),(-001,000,000,009,000,000,000,000,-001,000,009,000,000,000,000,000,
-001,009,000,000,000,000,000,000,000,010,010,010,010,010,010,010,
001,011,000,000,000,000,000,000,001,000,011,000,000,000,000,000,
001,000,000,011,000,000,000,000,001,000,000,000,011,000,000,000
),(000,-001,000,000,009,000,000,000,000,-001,000,009,000,000,000,000,
-011,-001,009,000,000,000,000,000,-010,000,010,010,010,010,010,010,
-009,001,011,000,000,000,000,000,000,001,000,011,000,000,000,000,
000,001,000,000,011,000,000,000,000,001,000,000,000,011,000,000
),(000,000,-001,000,000,009,000,000,-011,000,-001,000,009,000,000,000,
000,-011,-001,009,000,000,000,000,-010,-010,000,010,010,010,010,010,
000,-009,001,011,000,000,000,000,-009,000,001,000,011,000,000,000,
000,000,001,000,000,011,000,000,000,000,001,000,000,000,011,000
),(-011,000,000,-001,000,000,009,000,000,-011,000,-001,000,009,000,000,
000,000,-011,-001,009,000,000,000,-010,-010,-010,000,010,010,010,010,
000,000,-009,001,011,000,000,000,000,-009,000,001,000,011,000,000,
-009,000,000,001,000,000,011,000,000,000,000,001,000,000,000,011
),(000,-011,000,000,-001,000,000,009,000,000,-011,000,-001,000,009,000,
000,000,000,-011,-001,009,000,000,-010,-010,-010,-010,000,010,010,010,
000,000,000,-009,001,011,000,000,000,000,-009,000,001,000,011,000,
000,-009,000,000,001,000,000,011,-009,000,000,000,001,000,000,000
),(000,000,-011,000,000,-001,000,000,000,000,000,-011,000,-001,000,009,
000,000,000,000,-011,-001,009,000,-010,-010,-010,-010,-010,000,010,010,
000,000,000,000,-009,001,011,000,000,000,000,-009,000,001,000,011,
000,000,-009,000,000,001,000,000,000,-009,000,000,000,001,000,000
),(000,000,000,-011,000,000,-001,000,000,000,000,000,-011,000,-001,000,
000,000,000,000,000,-011,-001,009,-010,-010,-010,-010,-010,-010,000,010,
000,000,000,000,000,-009,001,011,000,000,000,000,-009,000,001,000,
000,000,000,-009,000,000,001,000,000,000,-009,000,000,000,001,000
),(000,000,000,000,-011,000,000,-001,000,000,000,000,000,-011,000,-001,
000,000,000,000,000,000,-011,-001,-010,-010,-010,-010,-010,-010,-010,000,
000,000,000,000,000,000,-009,001,000,000,000,000,000,-009,000,001,
000,000,000,000,-009,000,000,001,000,000,000,-009,000,000,000,001
),(-001,000,000,000,009,000,000,000,-001,000,000,009,000,000,000,000,
-001,000,009,000,000,000,000,000,-001,009,000,000,000,000,000,000,
000,010,010,010,010,010,010,010,001,011,000,000,000,000,000,000,
001,000,011,000,000,000,000,000,001,000,000,011,000,000,000,000
),(000,-001,000,000,000,009,000,000,000,-001,000,000,009,000,000,000,
000,-001,000,009,000,000,000,000,-011,-001,009,000,000,000,000,000,
-010,000,010,010,010,010,010,010,-009,001,011,000,000,000,000,000,
000,001,000,011,000,000,000,000,000,001,000,000,011,000,000,000
),(000,000,-001,000,000,000,009,000,000,000,-001,000,000,009,000,000,
-011,000,-001,000,009,000,000,000,000,-011,-001,009,000,000,000,000,
-010,-010,000,010,010,010,010,010,000,-009,001,011,000,000,000,000,
-009,000,001,000,011,000,000,000,000,000,001,000,000,011,000,000
),(000,000,000,-001,000,000,000,009,-011,000,000,-001,000,000,009,000,
000,-011,000,-001,000,009,000,000,000,000,-011,-001,009,000,000,000,
-010,-010,-010,000,010,010,010,010,000,000,-009,001,011,000,000,000,
000,-009,000,001,000,011,000,000,-009,000,000,001,000,000,011,000
),(-011,000,000,000,-001,000,000,000,000,-011,000,000,-001,000,000,009,
000,000,-011,000,-001,000,009,000,000,000,000,-011,-001,009,000,000,
-010,-010,-010,-010,000,010,010,010,000,000,000,-009,001,011,000,000,
000,000,-009,000,001,000,011,000,000,-009,000,000,001,000,000,011
),(000,-011,000,000,000,-001,000,000,000,000,-011,000,000,-001,000,000,
000,000,000,-011,000,-001,000,009,000,000,000,000,-011,-001,009,000,
-010,-010,-010,-010,-010,000,010,010,000,000,000,000,-009,001,011,000,
000,000,000,-009,000,001,000,011,000,000,-009,000,000,001,000,000
),(000,000,-011,000,000,000,-001,000,000,000,000,-011,000,000,-001,000,
000,000,000,000,-011,000,-001,000,000,000,000,000,000,-011,-001,009,
-010,-010,-010,-010,-010,-010,000,010,000,000,000,000,000,-009,001,011,
000,000,000,000,-009,000,001,000,000,000,000,-009,000,000,001,000
),(000,000,000,-011,000,000,000,-001,000,000,000,000,-011,000,000,-001,
000,000,000,000,000,-011,000,-001,000,000,000,000,000,000,-011,-001,
-010,-010,-010,-010,-010,-010,-010,000,000,000,000,000,000,000,-009,001,
000,000,000,000,000,-009,000,001,000,000,000,000,-009,000,000,001
),(-001,000,000,000,000,009,000,000,-001,000,000,000,009,000,000,000,
-001,000,000,009,000,000,000,000,-001,000,009,000,000,000,000,000,
-001,009,000,000,000,000,000,000,000,010,010,010,010,010,010,010,
001,011,000,000,000,000,000,000,001,000,011,000,000,000,000,000
),(000,-001,000,000,000,000,009,000,000,-001,000,000,000,009,000,000,
000,-001,000,000,009,000,000,000,000,-001,000,009,000,000,000,000,
-011,-001,009,000,000,000,000,000,-010,000,010,010,010,010,010,010,
-009,001,011,000,000,000,000,000,000,001,000,011,000,000,000,000
),(000,000,-001,000,000,000,000,009,000,000,-001,000,000,000,009,000,
000,000,-001,000,000,009,000,000,-011,000,-001,000,009,000,000,000,
000,-011,-001,009,000,000,000,000,-010,-010,000,010,010,010,010,010,
000,-009,001,011,000,000,000,000,-009,000,001,000,011,000,000,000
),(000,000,000,-001,000,000,000,000,000,000,000,-001,000,000,000,009,
-011,000,000,-001,000,000,009,000,000,-011,000,-001,000,009,000,000,
000,000,-011,-001,009,000,000,000,-010,-010,-010,000,010,010,010,010,
000,000,-009,001,011,000,000,000,000,-009,000,001,000,011,000,000
),(000,000,000,000,-001,000,000,000,-011,000,000,000,-001,000,000,000,
000,-011,000,000,-001,000,000,009,000,000,-011,000,-001,000,009,000,
000,000,000,-011,-001,009,000,000,-010,-010,-010,-010,000,010,010,010,
000,000,000,-009,001,011,000,000,000,000,-009,000,001,000,011,000
),(-011,000,000,000,000,-001,000,000,000,-011,000,000,000,-001,000,000,
000,000,-011,000,000,-001,000,000,000,000,000,-011,000,-001,000,009,
000,000,000,000,-011,-001,009,000,-010,-010,-010,-010,-010,000,010,010,
000,000,000,000,-009,001,011,000,000,000,000,-009,000,001,000,011
),(000,-011,000,000,000,000,-001,000,000,000,-011,000,000,000,-001,000,
000,000,000,-011,000,000,-001,000,000,000,000,000,-011,000,-001,000,
000,000,000,000,000,-011,-001,009,-010,-010,-010,-010,-010,-010,000,010,
000,000,000,000,000,-009,001,011,000,000,000,000,-009,000,001,000
),(000,000,-011,000,000,000,000,-001,000,000,000,-011,000,000,000,-001,
000,000,000,000,-011,000,000,-001,000,000,000,000,000,-011,000,-001,
000,000,000,000,000,000,-011,-001,-010,-010,-010,-010,-010,-010,-010,000,
000,000,000,000,000,000,-009,001,000,000,000,000,000,-009,000,001
),(-001,000,000,000,000,000,009,000,-001,000,000,000,000,009,000,000,
-001,000,000,000,009,000,000,000,-001,000,000,009,000,000,000,000,
-001,000,009,000,000,000,000,000,-001,009,000,000,000,000,000,000,
000,010,010,010,010,010,010,010,001,011,000,000,000,000,000,000
),(000,-001,000,000,000,000,000,009,000,-001,000,000,000,000,009,000,
000,-001,000,000,000,009,000,000,000,-001,000,000,009,000,000,000,
000,-001,000,009,000,000,000,000,-011,-001,009,000,000,000,000,000,
-010,000,010,010,010,010,010,010,-009,001,011,000,000,000,000,000
),(000,000,-001,000,000,000,000,000,000,000,-001,000,000,000,000,009,
000,000,-001,000,000,000,009,000,000,000,-001,000,000,009,000,000,
-011,000,-001,000,009,000,000,000,000,-011,-001,009,000,000,000,000,
-010,-010,000,010,010,010,010,010,000,-009,001,011,000,000,000,000
),(000,000,000,-001,000,000,000,000,000,000,000,-001,000,000,000,000,
000,000,000,-001,000,000,000,009,-011,000,000,-001,000,000,009,000,
000,-011,000,-001,000,009,000,000,000,000,-011,-001,009,000,000,000,
-010,-010,-010,000,010,010,010,010,000,000,-009,001,011,000,000,000
),(000,000,000,000,-001,000,000,000,000,000,000,000,-001,000,000,000,
-011,000,000,000,-001,000,000,000,000,-011,000,000,-001,000,000,009,
000,000,-011,000,-001,000,009,000,000,000,000,-011,-001,009,000,000,
-010,-010,-010,-010,000,010,010,010,000,000,000,-009,001,011,000,000
),(000,000,000,000,000,-001,000,000,-011,000,000,000,000,-001,000,000,
000,-011,000,000,000,-001,000,000,000,000,-011,000,000,-001,000,000,
000,000,000,-011,000,-001,000,009,000,000,000,000,-011,-001,009,000,
-010,-010,-010,-010,-010,000,010,010,000,000,000,000,-009,001,011,000
),(-011,000,000,000,000,000,-001,000,000,-011,000,000,000,000,-001,000,
000,000,-011,000,000,000,-001,000,000,000,000,-011,000,000,-001,000,
000,000,000,000,-011,000,-001,000,000,000,000,000,000,-011,-001,009,
-010,-010,-010,-010,-010,-010,000,010,000,000,000,000,000,-009,001,011
),(000,-011,000,000,000,000,000,-001,000,000,-011,000,000,000,000,-001,
000,000,000,-011,000,000,000,-001,000,000,000,000,-011,000,000,-001,
000,000,000,000,000,-011,000,-001,000,000,000,000,000,000,-011,-001,
-010,-010,-010,-010,-010,-010,-010,000,000,000,000,000,000,000,-009,001
),(-001,000,000,000,000,000,000,009,-001,000,000,000,000,000,009,000,
-001,000,000,000,000,009,000,000,-001,000,000,000,009,000,000,000,
-001,000,000,009,000,000,000,000,-001,000,009,000,000,000,000,000,
-001,009,000,000,000,000,000,000,000,010,010,010,010,010,010,010
),(000,-001,000,000,000,000,000,000,000,-001,000,000,000,000,000,009,
000,-001,000,000,000,000,009,000,000,-001,000,000,000,009,000,000,
000,-001,000,000,009,000,000,000,000,-001,000,009,000,000,000,000,
-011,-001,009,000,000,000,000,000,-010,000,010,010,010,010,010,010
),(000,000,-001,000,000,000,000,000,000,000,-001,000,000,000,000,000,
000,000,-001,000,000,000,000,009,000,000,-001,000,000,000,009,000,
000,000,-001,000,000,009,000,000,-011,000,-001,000,009,000,000,000,
000,-011,-001,009,000,000,000,000,-010,-010,000,010,010,010,010,010
),(000,000,000,-001,000,000,000,000,000,000,000,-001,000,000,000,000,
000,000,000,-001,000,000,000,000,000,000,000,-001,000,000,000,009,
-011,000,000,-001,000,000,009,000,000,-011,000,-001,000,009,000,000,
000,000,-011,-001,009,000,000,000,-010,-010,-010,000,010,010,010,010
),(000,000,000,000,-001,000,000,000,000,000,000,000,-001,000,000,000,
000,000,000,000,-001,000,000,000,-011,000,000,000,-001,000,000,000,
000,-011,000,000,-001,000,000,009,000,000,-011,000,-001,000,009,000,
000,000,000,-011,-001,009,000,000,-010,-010,-010,-010,000,010,010,010
),(000,000,000,000,000,-001,000,000,000,000,000,000,000,-001,000,000,
-011,000,000,000,000,-001,000,000,000,-011,000,000,000,-001,000,000,
000,000,-011,000,000,-001,000,000,000,000,000,-011,000,-001,000,009,
000,000,000,000,-011,-001,009,000,-010,-010,-010,-010,-010,000,010,010
),(000,000,000,000,000,000,-001,000,-011,000,000,000,000,000,-001,000,
000,-011,000,000,000,000,-001,000,000,000,-011,000,000,000,-001,000,
000,000,000,-011,000,000,-001,000,000,000,000,000,-011,000,-001,000,
000,000,000,000,000,-011,-001,009,-010,-010,-010,-010,-010,-010,000,010
),(-011,000,000,000,000,000,000,-001,000,-011,000,000,000,000,000,-001,
000,000,-011,000,000,000,000,-001,000,000,000,-011,000,000,000,-001,
000,000,000,000,-011,000,000,-001,000,000,000,000,000,-011,000,-001,
000,000,000,000,000,000,-011,-001,-010,-010,-010,-010,-010,-010,-010,000
));
Procedure Note_moves(var Board:Tboard;var Movelist:Tmovelist;var SortUnit:TsortUnit;hashmove:Tmove;ply:integer);
Function Movevalue(var Board:Tboard;var SortUnit:TSortUnit;move:Tmove;hashmove:Tmove;ply:integer):integer;
Function SimpleMoveValue(var Board:TBoard;var SortUnit:TSortUnit;move:Tmove):integer;
Function MVV_LVA(var Board:TBoard;move:tmove) :integer;
Function SEE(var Board:Tboard;move:Tmove):integer;
Procedure AddRentgen(const from:integer;const dir:integer;var AllAttacks:Tbitboard;var Board:Tboard;var QR :TbitBoard;var QB:TbitBoard); inline;
Function MoveSimpleQSValue (var Board:TBoard;move:Tmove):integer;
Procedure SortList(var MoveList:TmoveList);
Procedure NextQSInit(var Board:Tboard;var MoveList:TmoveList;var CheckInfo:TcheckInfo;depth:integer);
Function NextQS(var MoveList:TmoveList):Tmove;
Procedure NextInit(var Board:Tboard;var MoveList:TmoveList;var BadCapturesList:TmoveList;var CheckInfo:TcheckInfo;var SortUnit:TsortUnit;hashmove:tmove;ply:integer);
Function Next(var MoveList:TmoveList;var BadCapturesList:TmoveList;var Board:TBoard;hashmove:Tmove):Tmove;
implementation
uses BitBoards;
Procedure Note_moves(var Board:Tboard;var Movelist:Tmovelist;var SortUnit:TsortUnit;hashmove:Tmove;ply:integer);
var
  count,i:integer;
  move:Tmove;
begin
  count:=Movelist.count;
  if count>1 then
    for i:=1 to count do
      begin
        move:=MoveList.Moves[i];
        MoveList.Values[i]:=MoveValue(Board,SortUnit,move,hashmove,ply);
      end;
end;
Procedure Note_moves_QS(var Board:Tboard;var Movelist:Tmovelist);
var
  count,i:integer;
  move:Tmove;
begin
  count:=Movelist.count;
  if count>1 then
    for i:=1 to count do
      begin
        move:=MoveList.Moves[i];
        MoveList.Values[i]:=MoveSimpleQSValue(Board,move);
      end;
end;
Function Movevalue(var Board:Tboard;var SortUnit:TSortUnit;move:Tmove;hashmove:Tmove;ply:integer):integer;
var
   res:integer;
begin
  if move=hashmove then res:=TransScore else
  if (move and CapPromoFlag)<>0 then res:=GoodCapture+MVV_LVA(Board,move) else
  if move=SortUnit.Killer[ply,1] then res:=KillerScore else
  if move=SortUnit.Killer[ply,2] then res:=KillerScore-1
                                 else res:=SimpleMoveValue(Board,SortUnit,move);
 result:=res;
end;
Function SimpleMoveValue(var Board:TBoard;var SortUnit:TSortUnit;move:Tmove):integer;
var
  piese : Tpiese;
  from,dest:Tsquare;
  res:integer;
begin
  from:=move and 63;
  dest:=(move shr 6) and 63;
  piese:=Board.Pos[from];
  res:=SortUnit.History[piese,dest];
  Result:=res;
end;

Function MoveSimpleQSValue (var Board:TBoard;move:Tmove):integer;
var
   res : integer;
begin
    res:=SimpleScore;
    if (move and captureflag)<>0 then res:=GoodCapture+MVV_LVA(Board,move);
    result:=res;
end;

Function MVV_LVA(var Board:TBoard;move:tmove) :integer;
var
  from,dest :Tsquare;
  piese,target,promote : Tpiese;
begin
  from:=move and 63;
  dest:=(move shr 6) and 63;
  piese:=Board.Pos[from];
  target:=Board.Pos[dest];
  if (target=Empty) and ((move and CaptureFlag)<>0) then result:=((1 shl 7)-1) else  //127 дл€ PxP
  if (Target<>Empty) then result:=((SeeValues[target] shl 7)-SeeValues[piese]) else // 28...1279
    begin
      promote:=(move shr 12) and 7;
      result:=SeeValues[promote];  // 3..10
    end;
end;

Function See(var Board:Tboard;move:Tmove):integer;
var
   piese,target : TPiese;
   prevvalue,counter,col,cp,square : integer;
   from,dest : TSquare;
   AllAttacks,QR,QB,temp : TBitBoard;
   TakesList : array[1..32] of integer;
begin
  from:=move and 63;
  dest:=(move shr 6) and 63;
  piese:=Board.Pos[from];
  target:=Board.Pos[dest];
  PrevValue:=SEEValues[piese];
  if Board.Color=white then cp:=-1 else cp:=1;
  if (PrevValue<SeeValues[target]) then
    begin
      result:=SeeValues[target]-PrevValue;
      exit;
    end;
  if (PrevValue>(SeeValues[target]+1)) and ((PawnAttacksBB[Board.color,dest] and Board.Pieses[cp*pawn])<>0) then
    begin
      result:=-(PrevValue-SeeValues[target]);
      exit;
    end;
  if (PrevValue=1) and (target=Empty) and ((move and CaptureFlag)<>0) then
    begin
      result:=1;
      exit;
    end;
  if (PrevValue=100) and ((from-dest=2) or (from-dest=-2)) then
    begin
      result:=0;
      exit;
    end;
  square:=0;
  // ќсновной алгоритм
  QR:=Board.Pieses[WhiteQueen] or Board.Pieses[WhiteRook] or Board.Pieses[BlackQueen] or Board.Pieses[BlackRook];
  QB:=Board.Pieses[WhiteQueen] or Board.Pieses[WhiteBishop] or Board.Pieses[BlackQueen] or Board.Pieses[BlackBishop];
  AllAttacks:=AllAttackedFrom(Board,dest);
  counter:=1;
  TakesList[1]:=SeeValues[target];
  AllAttacks:=AllAttacks and NotOnlyR00[from];
  if abs(Piese) in [Pawn,Bishop,Rook,Queen] then
          AddRentgen(from,direction[dest,from],AllAttacks,Board,QR,QB);
  // “еперь идет цикл последовательных определений вз€тий
  col:=Board.color;
  While AllAttacks<>0 do
    begin
      col:=col xor 1;
      if col=white then
        begin
          // провер€ем последовательно от младшей фигуры к старшей- именно в таком пор€дке нам надо
         // разместить цепочку фигур перед минимаксом.  ороли тоже участвуют (у них настолько высока€ оценка
         // что бить они будут в самую последнюю очередь)
         if (Board.Pieses[WhitePawn] and AllAttacks)<>0
                          then
                           begin
                            temp:=Board.Pieses[WhitePawn] and AllAttacks;
                            square:=BitScanForward(temp)
                           end
         else
          if (Board.Pieses[WhiteKnight] and AllAttacks)<>0
                          then  begin
                            temp:=Board.Pieses[WhiteKnight] and AllAttacks;
                            square:=BitScanForward(temp)
                           end
         else
          if (Board.Pieses[WhiteBishop]  and AllAttacks)<>0
                          then  begin
                            temp:=Board.Pieses[WhiteBishop] and AllAttacks;
                            square:=BitScanForward(temp)
                           end
         else
          if (Board.Pieses[WhiteRook]  and AllAttacks)<>0
                          then begin
                            temp:=Board.Pieses[WhiteRook] and AllAttacks;
                            square:=BitScanForward(temp)
                           end
         else
          if (Board.Pieses[Whitequeen] and AllAttacks)<>0
                          then  begin
                            temp:=Board.Pieses[WhiteQueen] and AllAttacks;
                            square:=BitScanForward(temp)
                           end
         else
          if (OnlyR00[Board.KingSq[white]] and AllAttacks)<>0
                          then
                           begin
                            temp:=OnlyR00[Board.KingSq[white]] and AllAttacks;
                            square:=BitScanForward(temp);
                           end
         else break;
       end
          else
        begin
         if (Board.Pieses[BlackPawn] and AllAttacks)<>0
                          then  begin
                            temp:=Board.Pieses[BlackPawn] and AllAttacks;
                            square:=BitScanForward(temp)
                           end
         else
          if (Board.Pieses[BlackKnight] and AllAttacks)<>0
                          then  begin
                            temp:=Board.Pieses[BlackKnight] and AllAttacks;
                            square:=BitScanForward(temp)
                           end
         else
          if (Board.Pieses[BlackBishop]  and AllAttacks)<>0
                          then  begin
                            temp:=Board.Pieses[BlackBishop] and AllAttacks;
                            square:=BitScanForward(temp)
                           end
         else
          if (Board.Pieses[BlackRook]  and AllAttacks)<>0
                          then  begin
                            temp:=Board.Pieses[BlackRook] and AllAttacks;
                            square:=BitScanForward(temp)
                           end
         else
          if (Board.Pieses[BlackQueen]  and AllAttacks)<>0
                          then  begin
                            temp:=Board.Pieses[BlackQueen] and AllAttacks;
                            square:=BitScanForward(temp)
                           end
         else
          if (OnlyR00[Board.KingSq[black]] and AllAttacks)<>0
                          then
                           begin
                            temp:=OnlyR00[Board.KingSq[black]] and AllAttacks ;
                            square:=BitScanForward(temp);
                           end
         else break;
        end;
     inc(counter);
     TakesList[counter]:=-TakesList[counter-1]+PrevValue;
     Piese:=Board.Pos[square];
     PrevValue:=SEEValues[Piese];
     AllAttacks:=AllAttacks and NotOnlyR00[square];
     if abs(Piese)in [Pawn,Bishop,Rook,Queen]
                                    then AddRentgen(Square,Direction[dest,square],AllAttacks,Board,QR,QB);
    end;
// 3. Ќебольшой минимакс дл€ определени€ момента, когда одна из сторон может отказатьс€
// от вз€ти€.
 while counter>1 do
    begin
     if TakesList[counter]>-TakesList[counter-1] then TakesList[counter-1]:=-TakesList[counter];
    dec(counter);
    end;
// ¬озвращаем прогнозируемый выигрыш
Result:=TakesList[1];
end;

Procedure AddRentgen(const from:integer;const dir:integer;var AllAttacks:Tbitboard;var Board:Tboard;var QR :TbitBoard;var QB:TbitBoard);
// ѕроцедура ищет рентгены, наход€щиес€ за скольз€щими фигурами на поле from
// и если находит,то добавл€ет их в общий список вз€тий (иде€ слизана у Crafty).
var
   temp : TBitBoard;
   sq   : tSquare;
begin
  case dir of
   -10 : begin
           temp:=(RookRankMovesBB(from,Board) and (QR) and LDir[from]);
           if temp<>0 then
              begin
               sq:=BitScanBackWard(temp);
               AllAttacks:=AllAttacks or OnlyR00[sq];
              end;
         end;
   10 : begin
           temp:=(RookRankMovesBB(from,Board) and (QR) and RDir[from]);
           if temp<>0 then
              begin
               sq:=BitScanForWard(temp);
               AllAttacks:=AllAttacks or OnlyR00[sq];
              end;
         end;
   -1  : begin
           temp:=(RookFileMovesBB(from,Board) and (QR) and DDir[from]);
           if temp<>0 then
              begin
               sq:=BitScanBackWard(temp);
               AllAttacks:=AllAttacks or OnlyR00[sq];
              end;
         end;
    1 : begin
           temp:=(RookFileMovesBB(from,Board) and (QR) and UDir[from]);
           if temp<>0 then
              begin
               sq:=BitScanForWard(temp);
               AllAttacks:=AllAttacks or OnlyR00[sq];
              end;
         end;
   -11 : begin
           temp:=(Bishopa1MovesBB(from,Board) and (QB) and DLDir[from]);
           if temp<>0 then
              begin
               sq:=BitScanBackWard(temp);
               AllAttacks:=AllAttacks or OnlyR00[sq];
              end;
         end;
    11 : begin
           temp:=(Bishopa1MovesBB(from,Board) and (QB) and URDir[from]);
           if temp<>0 then
              begin
               sq:=BitScanForWard(temp);
               AllAttacks:=AllAttacks or OnlyR00[sq];
              end;
         end;
    -9: begin
           temp:=(Bishoph1MovesBB(from,Board) and (QB) and ULDir[from]);
           if temp<>0 then
              begin
               sq:=BitScanForWard(temp);
               AllAttacks:=AllAttacks or OnlyR00[sq];
              end;
         end;
     9 : begin
           temp:=(Bishoph1MovesBB(from,Board) and (QB) and DRDir[from]);
           if temp<>0 then
              begin
               sq:=BitScanBackWard(temp);
               AllAttacks:=AllAttacks or OnlyR00[sq];
              end;
         end;
    end;
end;

Procedure SortList(var MoveList:TmoveList);
var
  i,j,size : integer;
  tempmove  : Tmove;
  tempvalue : integer;
  fl : boolean;
begin
  size:=MoveList.count;
  if size>1 then
  for i:=2 to size do
    begin
      tempmove:=MoveList.Moves[i];
      tempvalue:=MoveList.Values[i];
      j:=i-1;
      fl:=false;
      repeat
        if Movelist.Values[j]<tempvalue then
            begin
              Movelist.Moves[j+1]:=Movelist.Moves[j];
              MoveList.Values[j+1]:=MoveList.Values[j];
              j:=j-1;
              if j<1 then fl:=true;
            end else fl:=true;
      until fl;
      MoveList.Moves[j+1]:=tempmove;
      MoveList.Values[j+1]:=tempvalue;
    end;
end;
Procedure NextQSInit(var Board:Tboard;var MoveList:TmoveList;var CheckInfo:TcheckInfo;depth:integer);
begin
 if Board.oncheck then GenerateEscapes(Board,MoveList,CheckInfo) else
 if depth>=0      then GenerateChecksPseudo(Board,MoveList,Checkinfo)
                  else GenerateCapturesPseudo(Board,MoveList);
 Note_moves_QS(Board,MoveList);
 SortList(MoveList);
 MoveList.pos:=0;
end;
Function NextQS(var MoveList:TmoveList):Tmove;
begin
 if Movelist.pos>=MoveList.count then result:=MoveNone else
   begin
     Movelist.pos:=MoveList.pos+1;
     result:=MoveList.Moves[Movelist.pos];
   end;
end;
Procedure NextInit(var Board:Tboard;var MoveList:TmoveList;var BadCapturesList:TmoveList;var CheckInfo:TcheckInfo;var SortUnit:TsortUnit;hashmove:tmove;ply:integer);
begin
  if Board.oncheck then GenerateEscapes(Board,MoveList,CheckInfo)
                   else GenerateAllPseudo(Board,MoveList);
  Note_moves(Board,MoveList,SortUnit,hashmove,ply);
  SortList(MoveList);
  MoveList.pos:=0;
  BadCapturesList.count:=0;
  BadCapturesList.pos:=0;
  MoveList.status:=SortNextGood;
end;
Function Next(var MoveList:TmoveList;var BadCapturesList:TmoveList;var Board:TBoard;hashmove:Tmove):Tmove;
label l1;
var
   move:Tmove;
   hang:boolean;
begin
if MoveList.status=SortNextGood then
   begin
     // здесь расматриваем хешход, хорошие вз€ти€ и превращени€
     While Movelist.pos<Movelist.count do
       begin
         MoveList.pos:=Movelist.pos+1;
         move:=MoveList.Moves[MoveList.pos];
         if (move=hashmove) then
           begin
             result:=hashmove;
             exit;
           end;
         if (move and CapPromoFlag)=0 then
           begin
             MoveList.pos:=Movelist.pos-1;
             MoveList.status:=SortNext;
             goto l1;
           end else
           begin
             hang:=(See(Board,move)<0);
             if (not hang) then
               begin
                 result:=move;
                 exit;
               end;
            BadCapturesList.count:=BadCapturesList.count+1;
            BadCapturesList.Moves[BadCapturesList.count]:=move;
           end;

       end;
     MoveList.status:=SortNextBad;
   end;
l1:
 if MoveList.status=SortNext then
   begin
    // тут тихие ходы включа€ киллеров
    While Movelist.pos<Movelist.count do
       begin
         MoveList.pos:=Movelist.pos+1;
         Result:=MoveList.Moves[MoveList.pos];
         exit;
       end;
     MoveList.status:=SortNextBad;
   end;
 if MoveList.status=SortNextBad then
   begin
    // тут проигрывающие вз€ти€
    While BadCaptureslist.pos<BadCaptureslist.count do
       begin
         BadCapturesList.pos:=BadCaptureslist.pos+1;
         Result:=BadCapturesList.Moves[BadCapturesList.pos];
         exit;
       end;
   end;
 Result:=MoveNone;
end;
end.
